{"version":3,"sources":["./src/app/units/place.service.ts"],"names":[],"mappings":"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","file":"default~favourites-favourites-module~main-main-module~recommendations-recommendations-module~units-u~e708acb9.js","sourcesContent":["import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject, of } from 'rxjs';\nimport { map, switchMap, take, tap } from 'rxjs/operators';\nimport { fbPostal, fbUnit } from '../auth/firebase.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PlaceService {\n  private _fbPostals = new BehaviorSubject<fbPostal[]>([]);\n  private _currPlace: fbPostal;\n  private _currUnit: fbUnit;\n\n  get fbPostals() {\n    return this._fbPostals.asObservable();\n  }\n\n  set currPlace(currPlace: fbPostal) {\n    this._currPlace = currPlace;\n  }\n\n  get currPlace() {\n    return this._currPlace;\n  }\n\n  set currUnit(currUnit: fbUnit) {\n    this._currUnit = currUnit;\n  }\n\n  get currUnit() {\n    return this._currUnit;\n  }\n\n  constructor(\n    private http: HttpClient\n  ) { }\n\n\n  fetchFBPostals() {\n    console.log(\"fetch postal data\");\n    return this.http\n      .get(\n        `https://propnexfyp-postals-test.asia-southeast1.firebasedatabase.app/.json`\n      )\n      .pipe(\n        map(resData => {\n          const postals: fbPostal[] = [];\n          for (const key in resData) {\n            if (resData.hasOwnProperty(key)) {\n              postals.push(\n                new fbPostal(\n                  resData[key].name, \n                  resData[key].postal, \n                  resData[key].imageUrl,\n                  resData[key].units\n                )\n              );\n            }\n          }\n          return postals;\n        }),\n        tap(postals => {\n          //console.log(postals[0]);\n          //console.log(postals);\n          this._fbPostals.next(postals);\n        })\n      );\n  }\n\n  addBlock(name: string, postal: string) {\n    const newBlock = new fbPostal(\n      name,\n      postal,\n      `assets/placeholders/property.jpeg`\n    );\n    return this.http\n      .post('https://propnexfyp-postals-test.asia-southeast1.firebasedatabase.app/.json',\n      { ...newBlock })\n      .pipe(\n        switchMap(resData => {\n          return this.fbPostals;\n        }),\n        take(1),\n        tap(fbUsers => {\n          this._fbPostals.next(fbUsers.concat(newBlock));\n        })\n      );\n  }\n\n\n  editBlock(targetPostal: string, newName: string) {\n    console.log(targetPostal, newName);\n    let updatedUsers: fbPostal[];\n    return this.fbPostals.pipe(\n      take(1),\n      switchMap(users => {\n        if (!users || users.length <= 0) {\n          return this.fetchFBPostals();\n        } else {\n          return of(users);\n        }\n      }),\n      switchMap(users => {\n        const updatedUserIndex = users.findIndex(u => u.postal === targetPostal);\n        updatedUsers = [...users];\n        const oldPlace = updatedUsers[updatedUserIndex];\n        updatedUsers[updatedUserIndex] = new fbPostal(\n          newName,\n          oldPlace.postal,\n          oldPlace.imageUrl\n        );\n        this.currPlace = updatedUsers[updatedUserIndex];\n        return this.http.put(\n          `https://propnexfyp-postals-test.asia-southeast1.firebasedatabase.app/${updatedUserIndex}.json`,\n          { ...updatedUsers[updatedUserIndex] }\n        );\n      }),\n      tap(() => {\n        this._fbPostals.next(updatedUsers);\n      })\n    );\n  }\n\n  addUnit(targetPostal: string, unitNumber: string, bedrooms: string, size: string) {\n    let updatedPlaces: fbPostal[];\n    return this.fbPostals.pipe(\n      take(1),\n      switchMap(places => {\n        if (!places || places.length <= 0) {\n          return this.fetchFBPostals();\n        } else {\n          return of(places);\n        }\n      }),\n      switchMap(places => {\n        const updatedPlaceIndex = places.findIndex(p => p.postal === targetPostal);\n        updatedPlaces = [...places];\n        const oldPlace = updatedPlaces[updatedPlaceIndex];\n        const newUnit = new fbUnit(\n          bedrooms,\n          `assets/placeholders/floorplan.png`,\n          size,\n          unitNumber\n        );\n        let newUnitsArr = oldPlace.units || [];\n        newUnitsArr = newUnitsArr.concat(newUnit);\n        \n        updatedPlaces[updatedPlaceIndex] = new fbPostal(\n          oldPlace.name,\n          oldPlace.postal,\n          oldPlace.imageUrl,\n          newUnitsArr\n        );\n        this.currPlace = updatedPlaces[updatedPlaceIndex];\n        this.currUnit = newUnit;\n        return this.http.put(\n          `https://propnexfyp-postals-test.asia-southeast1.firebasedatabase.app/${updatedPlaceIndex}.json`,\n          { ...updatedPlaces[updatedPlaceIndex] }\n        );\n      }),\n      tap(() => {\n        this._fbPostals.next(updatedPlaces);\n      })\n    );\n  }\n\n  editUnit(targetPostal: string, targetUnitNum: string, newUnit: fbUnit) {\n    let updatedUsers: fbPostal[];\n    return this.fbPostals.pipe(\n      take(1),\n      switchMap(users => {\n        if (!users || users.length <= 0) {\n          return this.fetchFBPostals();\n        } else {\n          return of(users);\n        }\n      }),\n      switchMap(users => {\n        const updatedUserIndex = users.findIndex(u => u.postal === targetPostal);\n        updatedUsers = [...users];\n        const oldPlace = updatedUsers[updatedUserIndex];\n        const oldUnitIndex = oldPlace.units.findIndex(u => u.unitNumber === targetUnitNum);\n        oldPlace.units[oldUnitIndex] = newUnit;\n        let newFavArr = oldPlace.units;\n        updatedUsers[updatedUserIndex] = new fbPostal(\n          oldPlace.name,\n          oldPlace.postal,\n          oldPlace.imageUrl,\n          newFavArr\n        );\n        this.currPlace = updatedUsers[updatedUserIndex];\n        this.currUnit = newUnit;\n        return this.http.put(\n          `https://propnexfyp-postals-test.asia-southeast1.firebasedatabase.app/${updatedUserIndex}.json`,\n          { ...updatedUsers[updatedUserIndex] }\n        );\n      }),\n      tap(() => {\n        this._fbPostals.next(updatedUsers);\n      })\n    );\n  }\n\n  editAllUnit(targetPostal: string, targetUnitNum: string, newBedrooms: string, newSize: string) {\n    let updatedUsers: fbPostal[];\n    return this.fbPostals.pipe(\n      take(1),\n      switchMap(users => {\n        if (!users || users.length <= 0) {\n          return this.fetchFBPostals();\n        } else {\n          return of(users);\n        }\n      }),\n      switchMap(users => {\n        const updatedUserIndex = users.findIndex(u => u.postal === targetPostal);\n        updatedUsers = [...users];\n        const oldPlace = updatedUsers[updatedUserIndex];\n\n        let targetString = '-' + targetUnitNum.split('-')[1];\n        let unitArr = oldPlace.units.filter(u => u.unitNumber.includes(targetString));\n\n        unitArr.forEach(u => {\n          u.bedrooms = newBedrooms;\n          u.size = newSize;\n        });\n\n        for (let i = 0; i < unitArr.length; i++) {\n          let currUnitNum = unitArr[i].unitNumber;\n          let currIndex = oldPlace.units.findIndex(u => u.unitNumber === currUnitNum);\n          oldPlace.units[currIndex] = unitArr[i];\n        }\n        \n        const oldUnitIndex = oldPlace.units.findIndex(u => u.unitNumber === targetUnitNum);\n\n        updatedUsers[updatedUserIndex] = new fbPostal(\n          oldPlace.name,\n          oldPlace.postal,\n          oldPlace.imageUrl,\n          oldPlace.units\n        );\n        this.currPlace = updatedUsers[updatedUserIndex];\n        this.currUnit = oldPlace.units[oldUnitIndex];\n        return this.http.put(\n          `https://propnexfyp-postals-test.asia-southeast1.firebasedatabase.app/${updatedUserIndex}.json`,\n          { ...updatedUsers[updatedUserIndex] }\n        );\n      }),\n      tap(() => {\n        this._fbPostals.next(updatedUsers);\n      })\n    );\n  }\n}\n"],"sourceRoot":"webpack:///"}